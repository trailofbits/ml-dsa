package mldsa87_test

import (
	"encoding/hex"
	"fmt"
	"testing"

	"github.com/stretchr/testify/assert"
	"trailofbits.com/ml-dsa/mldsa/mldsa87"
)

func TestKeyGenZeroSeed(t *testing.T) {
	seed, err := hex.DecodeString("0000000000000000000000000000000000000000000000000000000000000000")
	if err != nil {
		panic(err)
	}
	var seed_copy [32]byte
	copy(seed_copy[:], seed[0:32])
	sk, vk := mldsa87.KeyGenInternal(seed_copy)
	expected_vk := "e45ffc8cc73db885dc662e62a18cd8e3803297117fa5658814a985b5ff1db7b468cfc82bb929f1d86b77ed14f5ae16a65368772ce51912410105e0456975ae91fdb643b512f124d5e60bd68b8c7e31fe01c7b0dc65ae470501cc565a6e1dfcfcfd12565433c4afedd511821e2e9610c45275e2836dee35ced69d7efa672fd1e4318bef5eb6e897e8b451aa202ded042b2aaef77a7be3f699146da229a8bdb3ffa496445967e75217bfbc9048f9956443d8731f833eb30de10dac96fffe7cf65ea0445c3e31e8601e133be6a100764fe3196e267726441f31751fbf9a6f5880644f4e7275e57de2b0f105e4db055d50dd1c9c934fddf535b8de28b0c74c0449f222cd2ed0bb8fbc775ccee8c940665b40f712f4f7e00750e9e1e4cd9cff25d1945c3e9bca53ccd4f12eee7581856ebd68f26845956e3e7beb761f0fe75bdd31bfe2fa018113397b387bd59d62a68b8af7fa245ab932e69f778e2ceefd21304fbb8099ea13d8ea57c1813197a2f75ae251075b51dad38f853669e9d5f98a3655098941993a1594860fba71fe530ee5c29f58f2978af688ccb75a5838a359c112e98e25a8583ac8dac1f861fd58e2afba5de5a52e020904f5b42bc0874e35befcf3e6119684768f36e008f04712177cebe627607381e56eaaee161c1729b8de51dbde474d48cc68249ea27162b87993e60c84ed6cc6423cb3676d9eb50b2cab5a3a049ef131381d623fa6fbcbc9db1e7cc025ea0418b9dad2cc6ccd4e95fa2cec24feeca70318a751716b7213f63edbf65a63338357f838f94ec071822c24851248885107b3d1c4e924678c7614ea1af038104619f2ae372940becfa69e29cbb5ff6c3e20a47be4a4f74bac34c133c00a6a706accc6ffd3d8e4fbd69a99704e1283c850d8c58d1e5753cd9587b83c4c346cb9a58137213ec10834c66adfe2bb5c501a8ef2ecadd1b677a3df1a6deb86ebf0722c4f5030e20f9018dd5b6fc53eea24fd92b7b5b4025feae996d3e48fd4c650d82dbad7eaf936639698512f26253d2ef6847c8518e8565cc9a5495c6fff57cde7323882c54a7db470ab2daf8ffd2bf794fa7c692d9e7fbd532eecc1d7880e2ca0b3216128be28b4a9f1d151fac97808b0bd98b7b43a612a9ac865812bfeac6f47460277840b52a3b087f916ca7cedc0f768ea2bd19ea21155f84b4a04c4000ad2ae0587154d560bc0a477a4f9329a8984dd31eb1f2a05e3d918701d630cfca9af61ef088d2c5581acb463e439902e5d425719e956b8d6df7305b28e0ff27d3ad0de2085d292499b19a3390d4396fb3bac9a8d8cbead2a7a4290fc9ac6fca045f98a614a45a39cbe24360f84d14f8e472712aceb74dbf45b53d49a0e4737e476ffc4d5b2f7cd247aa186d3b764ad9e9cfeee456a73c291d8de3912414ac43911c372173ad7b472af35c6853ced2fe7b5fe0a89565ab33baa6f65cdd928319d7065e040e7a5e84f9aa903f7648094bad07136b16927b8ec6dbc2bef0cc2856de1e795923e1412c49f24deeb6c21f6c8a9765c9c7986e0da4b4c67d8e0d0c8d466824fb923d8573148990cd2ef133c78ceecab72ed9dd285c5a3766852d54534207ffd34027f6c76ede8fd1a32d72c30048bbaa797d5df6fde27d087de5721ad7b7fa3e8d3f70d6bfc3ab2e252335368bbfa15acb5cb37d4694e8b23cebe25de9c925a221a183b904d3f85df9929a919c54d6f87457373a0d6ecc1403e4cbbe620999435e80696634cd1a8e4747e9825bfa336e5bbad14f73640f1b9febe800dbaefe1630c61fae635b074c564eaa9db189c9e7302873fc64e6d497bc5c29080987a07a21d4af210703a4fa07f2fd816f12fd1e29b4c0f44afe9bd4a1eaa8a7ae6f02a5b4258f52caf6127f62632a67cf4e8310be56a7c28c86b2e277600c3e92c8d23d42586244c571e90568df202f2f6d81f860a565f9eb91a3c78372e2a8b1be61c5418cf49bf2d6c8955d4a482a9919b7660b3f9a4404ffc454ea073e1e4b2689ab2cca4e46bd7004a6c491fa26ee7a57d60f35edb2b821e6266442c8f335d452d524c772e0353724c23c7dd15b7aa155e91442022140c5fcb0153147edcf3e8952f6f0399a3c88066a72756c9409915de63f64fa797841c57c796c6fc550ef745dfe9f179457f94755ae5a2506a764f327e550be3dc14dd41f3b04b147d454938c63a8d69b2ea4c5710ec0b36e3a6c72571fa5d59dde036c42033df35af056966ff0cd1204008971aa6ba9fb97b685ab9ffa2a9d1778104cd2c3b326de1fcbc242e94d0311c3275b12850ed30ceead3a2ee6d060508411d4396f5421d8b6d067cf7cb5e826785fbe119e05e21bd879b64f57cb0cd1972c2815f20abe7ce6ab34d0f471af44baad179e90644122f5f33288e689ddddc5ce833e9755df1e73c65c5a201c4ede2ffa6b19274927719d2d38fdb7a65aa43708b7fa9a94aa7d3210253d78d3b181e1020d0000bd0a1dc05d447f9f58ebeb84c65b36c8afcb83727a1508994e826957a663b0b9b8a003325ab6d6d6462ee4e106019c0dffe10323b7bde7d82a38f85fd08786e860ba66c161b64b0708c363de5c6af62d8db3c243d1e1b712cb1d59e942b9b6b4295a5a500b182cbd5fd1bc6ce9376d91b47a2284f1fbe0ad1c048cc2cfbb4afa3a9eb9697503b69feca990eba7e9441af9ca44cb3ac6b5ed66e591c201fe30efa8a7c471dc613d6254c263a8e132104bec47f1aacb3b2fcd4051b69b5e3fcb1c147a65c2f90c4b5188bafc521cab03c12a309da50b5a7517727ed41228ed123fe1b152f6a6319cd623bf34ad7b8e064ab993260bcbd405f5b7fff9b2fa40ba5ed5630242539e5d96823e89dc818a13d16675ee3079d976f694f5acc9760ae789e9b3391b289e0e22a7ef17cc6a4577157b6d95c09baa4fd532e3ee0a290810ed35e56bb19d9b61fb98a97c617425b06093d98a5cf0ee2dd127f0eea600b9a0c67fbe761db9b77e5d5bba9701da1b883e521a0cfe88451f57bd36085b67e56f061f84a2e6a152a71bce6e522daab6a0a33ce22e537fa9793d28b617e6c0a4176a83aa3be578afac0f2f5547c5516d218984755b7445c7143afa4e551fce0071bdb873b34e6b9e2b9e79ed0c69d288ed6421f237e860a0c6492ebbdd2a44c2c4f368dbe99941b1e8561d859d3859f496cee3d741f252973f8fcc539c409e35cc80a5ed6df23cc3a65601313f5d681fd9540c5291a9e30a72e38c96413c47c61ff84fde78d011b01b4154d1b920af003f7abb1e1999dea6a766cf9fd2702b3ce0ee57af931b62124b0861b163a3b91aa4bea28076c3432df3b29b6c4e1ba588def420071fc157de90eb2722ecc9ab00df3c669383a61a91bb67bd287ce349b4745ee7a479dbceef166b9acc412eb579fcd6437307edda253d606b7be7599c38092bc52a8598480edab8b82b1d21c565d2137ceae0b6642619b16133d91205d6355029e9cdfeb9a28b373d95916b6b707d4c712c09cf36daf1a511b2bedb1aa70ee58d46a0666bb287784b0a3840c589a7a04d5d6f2216be90aa4a512d5632f5c9bfe7b8b13382f999b95d367c7c46b968074ce315197a5ff3545c7b77a804ade56a95b5c24cdece5937b5c0366d93ad03da9bc5db1b551dfb91e9b343d2b57b763439686d4a3"
	actual_vk := hex.EncodeToString(vk.Bytes())
	if expected_vk != actual_vk {
		len := len(expected_vk)
		for i := 0; i < len; i += 64 {
			stop := i + 64
			left := expected_vk[i:stop]
			right := actual_vk[i:stop]
			if left != right {
				fmt.Printf("\t%d\t%s\t%s\n", i, left, right)
			}
		}
		return
	}
	assert.Equal(t, expected_vk, actual_vk)
	expected_sk := "e45ffc8cc73db885dc662e62a18cd8e3803297117fa5658814a985b5ff1db7b48b4b1d93b0d331474ffab799d65a892fdd47bacadc962323a32fb8ba1549d1614003a426a09cd5793161855421e3319f60e3dc367c7c458d5e5a6dfb0203737931338b8932cfd38e7c98ebd273ccc0706b6d235ee253d15f8cb7c42ef25dfe6f0297681881444808881109120b0666241269804486a1385024a0210c280e0a86211c3110208549014488db24914c048c58849042360ac93608d42209028329d4a23083c02d51b00098a291938490e31686c2a2108c46041a49021c09505c28291449660a1366989805cac40dc8b4210a81108b208508090e5412641c3849592231da242d818009dbc84c04206103314d882825d84669a04801840065e492108818841b3066500860120664003420c918921a326d43c82d99328e4c062818282c5b3884d44431d92065892888d1022e1ab505201510d0a870d91864a3200010b7515c4288913610c82681502441024205a244891c036d00c2854902409c888ca026691239101904508a468e0182681a216924b02023036d1a0430d920105c264de3360c41208453246a01240291804051449111302d039845db90015c2441410445539460d1368564484623c53091400a1939014ab00420053158041000981142042451864dcc224d094330c30291c4024cd0303140146210232451242cc0000d81c2685a38440a49620cb2301cb52da11649102052233685c0044e819685c31241c4004a1b068424b46488c60d03a380e1a2081aa66122246edb4831d39885e1a48d1034520a398048106e9400928318899ca40961364043120491486a04b08c11418c9a822153c6681c15045a00418a4845d98220092750620201ca22525b92890201910ca94494168ed3446d52020c8a308e19095083089111b7500c240620374e24a0694a002cd492689a048c5b309262388e2181294ac84c08968992408edb2086d4a025e0088a094348d2460012475002a910201509a3260614018618352101474d82244608449104958c90186c220600212420e2428604465020924842826d522006dc102e14190e2047715b8001dba669d29829022630543068e20622a1027282b49058268ae0041009416452b80c1bb725504891e2184410b78911012222a970e3481111118000b90d64964821246512242422b2881a336ddc48129c12902199699316282246845988904992711a2186119104c0b420c9980152c86d0c030d5b002559028849a605ca228802920c49428cc33430a0108e1a93601cc4214c103091120ee4249184462852264e5398895048210a34658310848b002a21323260b665049165619608a31205e346109c228089061111402808a70c0ca981c90271d3c88d49c0044ac090a1440103126061000508b26d88b824549464a1a6711420611a1284dcc8608cb0614c024d02306554060a9b828c0b114a03268ec9389201b30d189451a1188a80406884200c1a1841a1444c59480e22b0108a102aa1144a20c14d1b3309918411430892143261449284d2424e22014010312d5c904454262de0100a231080000380dc4422c0146c89001219304021824d8b324652488edb26291c35651b822c4ac0101aa82109956c0bc94920a47024a74809142d2440010813401a4829d4a64524286ddcc08801360e9820701c2466a4c488614662c9a85081304c20b22001260813032964b225d0068a5a12890a974d80200000242180b66c1b410ce0a621910842533091d2206e1a3784c204250181910bb6659b324c93008989080e0a034a44968ce2868c8010310a910824032618286aa430101ba5419a309020206821a388d4b2700806849a46011ba22d00384258c84009302e00916490428422b4644aa20860c40c5a244909b051cb3826249730a1a24c91244204c8511c82688cb20004b1501c802480044d11b84563a084921026c04452d2c09000b461234240448268e2206ddc462d12208a0b144c1c9051022112602824e3048214a18822902502a881d4b481d286014b802199c84c9c1491a408528ba008002852e1120102a10c5036824a884d4c341288820483000614407119028813c03189a804cb002a01c08121a80c88108a122124c1b2081b22859c0282210608632261e088694402041325928a2444023986da16488c422ce49825e09491a2aedd1978bd53fe5849e87903a7a2eb50a4b7e48d7077b437d1e7e53fcd1eeaebbc0f1fe99cb201b894da9a427f2d597c6799b407909a27db2bcf1ff0efb49fe77a254e6cb140affe42756d0e7dde27201db0b1dda5c5a56f070ec812164ba0f36e086beacff9c5f055032fddc65062e1e1347aad215202f2f1429478afa2bb723200c3534d0b3cc1e4c3b314aa59951f528c50b2a82c111584a530b0368dc16292d2f1bffb7ef92100deb150d4334d345dad81a4feaf918940adb77a034d3d5a920c7257c965f15b8b11427f14158add40af892563ae75d6e90b9984bfe5445acf9615ef97312b67ecf0f8bc996d4023fd4e9b8101eadf4a28961e8d8d07e850b351ca48b8ea8bec3c20ad49af386dd0876b1940548389e6e01373dff1974ed3c5544dfffd1b583bdd2487ccac63fd6ec90e5fed37d6c77298f67e70e31c390ef53b58c90d19ccf5c52a1dffd403a4cd922ebc3e5318852faed6bd4e6b42a2197de547b8bb59b3e7d29a8b5277aa22e11be5fad69c8289e04e0d45e35441dbc5d4b01f22e1c48eee9ca5e3f942cde10bd31e973ced0112ea3245323397b22364828cd10d9539917774b6c28b3c38cdcbf1fa44b89f693f3e2c610cbacef6179606983d0d5e48d434c1c15501af47ea9c2cda694598d6e42d06f3695222ae3498f00af716d375f03d3ecf8ce6ceee007b473072655879c1248cba3ca407e6f480d260f2fc1727ae0050eb6b49303c78d89bff1402acb965d3636bd8a937e8827ba73683e1bee6c83ea50d7c0df3a0fbfbee260bf349e8342aee4a89166c0dfb6c8f23a138915aabfaca26ba2007805069fef8b52716207fc1f74f83a74dbec649f11c6846ccf4bca4413476a89596d89cb4ab05181d95235b528de99f248a667e28b38e9d6851420fb03313c36ad3ece85e7691fc46f391e10590fd1c6eed9f0369b01812fab02b38f63b18ba9dcd62bc48ec53e7f25fc81eb536ff48fe2b6039255bf309cf12c9ea14efae5fbe83bfbb94028a7836d7c87443da55443529e50ce90a0c586e1438ffb2ea2299beff4ba7a1f3c0c944185fc5ec2f37def97d29324bea95bffedd0914695ad720d04c617daa46eb00ffe801c8889e4eb746b0f41f5fb9f5cae89cfdb2d54a3d7d6a7c07f1191c4ba7b4cc973ca5667a3c38777b0a867c44c7b180c1f4ad2509182a1603634a86183f3a4f2c760fa6157e5837df139726ce61de9f85c962746bf41cd6771c168b4a6e6ab83d2440dbb7d5d0b39b308afb4bb860394a738f548f828522e00f50c2296d875ac8556b08112619be0c2be50e34dc107382da51d0a71baa35e3eaf5a63165f977de4a1df4caa32232a59c62b6c663dc038ce59e36caa5b8e66567cc29d7cd082404f8a5b0cc4ce2cd4b8bd31833a2af3aa5ceca7978f893b859ab0a803aefe9fe060aee139a033325f06368924500c252f460fb8e82159e75b87f14b9b44aaa543c2fc0c56064d0e5935ee2f00e5e484414c627abae0e2930b6ce7dd02a0c101b6635d822b5425e40e9468ec5786798ef407dced95ebd97cf6ea432b50ff6115afa1ea3c47f1bf2176ebc3a3eaccb408168c83f09f17e8976634a6dccb858de0ae98abd5addf0bd188494f9d203286d4a8c2ac84ff5b31ef2e95bf8eabe732131ad6349fa9ab271e486cab4058a3b5217ca43060296725600e32232c2628bc5319e6cdb17fb692f4333bdeda4c876347fb3715e590076ed40059a19707377530342fc6ccbc6b30f9e8d765cbaa2800cce37dac65050613c390a604cecf6db26e94fcefa67a976a37bdd0fc67888a441a38202d0197d7becd4ae958ba008fb0260ca3fc5721225316a8ee91d6e638d0abc2a820391cc7605d8cce4b41bb9b78026319b3318fe85cfa3e9608c1c844bda5cf9bcd59b15f9b981001d9c303e321f2f79d4f9e7009c93a7480ab736f547346354c40f1e0cfdb58ad2f707ca2a0d561c77104eb5507646933df68d02a5e91d7ff612812e40ac82f3e0847f81be9dc6cafdebea314ae524ef31f47b2bc8479660af69448e6857bbe5ee294358af90d0d6e55df40cd8c50b70dc88d36c4ac6d3e1573e051f9a69d83f9ab9fea180432fef192b97d922393d6bc18b916ff3d9739a3f542ee94f722a876406ddea30432731551c3c1f9aef463e2849e57a2d46741f29d6388b4c8c96fc60885868c96fca8307f9c2cf6380e15018545c338d8046547cc0e735caee1c2049ed571baf816280aec49fc4a3a23e2f6e9937efb200c428c96444d90f08a3bc7f1cb15e3c2f1d5c289569d20c4dbad4cb694e424f9cef742d8104d762fdadfbbd4419603f44e6379a7ad21d0e44542d987eb5a0b841be8b2b6733463a1d6ae2a36e35025df30b827a78ff0272e7a7ef827aa1752648678e999c50e3b75bfa8c9a421ffd3f6cf3fb45d1ccde059cec01d3b98b5c8553063addff3cc1bfca503c8eba5c15ad11481b398cc8861344de0121a61a5c1f0cf2237305c42dd6e4788c3b6770a0f1887b137d319eabbbd806ac20165a11f09ab4faaf6fcc1d58b25115340713c0793607863c5b807a2533ff797c251d7bbbf488045b47615c981ac71b13e29375c821a305d55b61fbf3ade7bbc14e3eac68e9937a90f3fdc26cfdef42ea1b70c7b42b9481bdc2003d419d19236ba1a794ab72b2c5528f486e06c12886025644103a51a75b2eea8210bf5e8e2564afde492cb2d27bc898deb903b7c26be27bdb30d46fb9ca8d0383bf2b82f01cce90ff4789fc4627ec46c25bda4177d2c8e3c7bfd2a9a405e71cfbc1fae4967be1c770c9ce04ade0e9dd264b8c946063468c8bb196661bddf69007a3711360ecd3b739038f1caacc3d2f4431109b48a221b6ea435ed29b2641009f94279fd6eb84703a458373d7199ad9464b38a2cffcb334a30e639cfefd3bd077ed66789a1d9c96fcaaab4ed66b7702ce3fe342f2e77ba045173278b1820f53c640ad57292498cb40174c75d21a27bc791b5848bf7424013941f1bd5430830279bec83b7a384b03dd0893c7cd30c1d9df34476bec6e7a899bbdd5124c3310cd7e333d47d67795aad559611a46f2d2c03b2de831eb086f426e29b1da4ce059a3ca8f8354f3060e2a282f0cf4eba7c0a2a7f3c3962ef61f4c27a8d458157ac2d1ade2f571042468a60fcf1059f89703865b5322fc235f36ae54039704e5ad26cf176a474ae5138b19f8fbfd07509850b9eea74dd80d74ff81b0493d7d12925a4eb290cec5e237ac568c52fdea6389d918e500d3a46a04309b6e8b35fec84bcb846cc51663816298bac5993090762262657f257327c42678d059ecf2f807716a087ff99146a4f6d7d5b10eda55533d0a700414b87ad776934db5f6f14fbc7078e57c15eaa1d973f458cbafff1b2bb3c57b883d3fbfc5278c1d22e6c63c9919057f5abff82f4c7f777925c2130f20696856ee8b2818a39a17f984b4a6501494ffbae810dbfbc7aead218198cc1f2f2560b5b5a26fe167033cd66a274d7cc43a77377166a0efd0f3ca08c940ef3674d73c94f6768682162472dee47411a58960c9a1f6cb06ee6a80febc382023e64370dc719ac1abedb8678a19dda1cb2a3de147bb0927b3461aa5e897e9072bec81e0f84459c2d4e2831a088021cf9b2207a63e433cd676ba84be74e59fc2c89f57c139b84dba7cf0159976a86ed96fbe1484581ab54ee3060ef11d0b40adb6cca4bbd0c3293f8744777d23b8abb3ed4320a8709cee45d948d52062c9298cc94da9bf588a29ec63d619e9a1e8b275fc54e610c5a41f85c1f6d038e05a915837a2f0f8c926497656e03c2ba48c99b1dedacaa7fe47036c0cb507b0fac8bfe39669a583c152f42bc5324d4609a02aeb675dfb891ec1910a512424fac8359c7a37cf580281736690048af938b25a5cffca6779f149d334289a031bda66ee018e1cfc5a6e98d194af216b7bd68cddda6c05154e336d52a323f651ff8112c345dff63ffa4a516e9d8eff5e38624ccf5f3d516fcb0c792b05b6110f822428395cdf0a55b02bb055d4460f40c73b75d979ba4557bafea7682df295ac079e611afcd3b500ba0e2bbac3616d442d19e1b05030f3c72f80df5166b309eef8e32455c512314a4269027faf8147792f93a7e714b399c8cde08b5564c997247dc5851350582f315d4d022fa96f5c95281172090bc5ac86a90dd917fb69cda8bb93bb06df6a2afe3928f0b389ea55f6a71ea278476e50fab9d7dfc614ae4d5cffbe90b10243a8a03d6a22cd556d3e3db1eb4db4047b3fe464406a4c548e77d0b4366f2fcc99a8e8c0c410294209a4b9a07971fa7166263a2906d0aabc0be475bf90223c7bb4dc484149c3a87d352181b90878570fe625bcf487646f2687f5ce82f159b3f82c9280b7b72daed879eee16efbac6ca6f4577633d9e67d13afd9d92a3e49f1cb12fb3e7a03255a6aa6c0c94c3d134c39ec6f2c22011ece1a0fa53388c50a7add37a8abf8c03d0b89df833aad160da7a9ff7fe361d01a6952da6c1289a968b83f45cd4f6a32dc6840bc3fa0b0d35c64ca52f1b42c8b1365d7c6ce2376e1ec45aa2535a3862f54376830d0c9f8a4fc71a5b6fa31cdf7a02ac9d821fff30d30205c1aef5f3eb8bdbfcbb7bcafa829cdbf4671004eb6a75d4521eff973c7cd4876ae28c36c82b10bae4984cc7835c23507e28d7caff706b28672bf645ff3bf0b"
	actual_sk := sk.ExpandedBytesForTesting()
	assert.Equal(t, expected_sk, hex.EncodeToString(actual_sk))
}

func TestSignVerifyRandomKeypair(t *testing.T) {
	sk, pk, err := mldsa87.GenerateKeyPair()
	if err != nil {
		panic(err)
	}
	message, err := hex.DecodeString("48656c6c6f20776f726c64")
	if err != nil {
		panic(err)
	}
	ctx := []byte{}
	sig, err := sk.Sign(message, ctx)
	if err != nil {
		panic(err)
	}
	assert.True(t, pk.Verify(message, ctx, sig))
	sig[0] ^= 0xff
	assert.False(t, pk.Verify(message, ctx, sig))
}

func TestSignVerifyZeroSeed(t *testing.T) {
	seed, err := hex.DecodeString("0000000000000000000000000000000000000000000000000000000000000000")
	if err != nil {
		panic(err)
	}
	var seed_copy [32]byte
	copy(seed_copy[:], seed[0:32])
	rnd, err := hex.DecodeString("0000000000000000000000000000000000000000000000000000000000000000")
	if err != nil {
		panic(err)
	}

	sk, pk := mldsa87.KeyGenInternal(seed_copy)
	message, err := hex.DecodeString("48656c6c6f20776f726c64")
	if err != nil {
		panic(err)
	}
	sig, err := sk.SignInternal(message, rnd)
	if err != nil {
		panic(err)
	}
	expected_sig := "b5d78c7eb1c1cc4494f2ba8baa9e64d1764d5b424a155b15ae607cc72685d50641b046c8e5e5ddfc586d486f566e30789d8c5f75cde7067248b59619732ce8747dbc1402a5302ca44912a9fa7992e778094da7a178101abb677996bc384069e6d8d013f9cd8378ede06f5be021a4212d7e25325f1f259dec6b6a3b0eddf3e8f01224d409794f01dd96a205f351932fff2ff2efd3d5b4565c61c97925de2888b81c4c28c8e710b180a25e79061503d61ca76efab2468262873133e9da12c1fb8ef59f7147535827afcd20d1c92b1b588826d29d87e3f1f5bc0ed7de90c398b1a7fc825ec8cadcc3bcd2705ae8a0cddee3f002ba42a150fe25902719090e7b9ed1a78fe00d74c18525e9111e757b107605935e59d5e6a1d2689ae6cc421d091deaa86b3fb886d893f06ef9e13e4c10eefcec6f35e43986db3231439bcac34174c4a3b3aeeb87a8db0c11e4187ccf24886f9b38aecceb77717d528d4e3f362447a9fe43abc7ecc541cc194da1d8a6033d66ea023bd5e64e5288d41ce8861e11bf944631b3f4fb540c2d01acda94ee9c956a02fb768d1aa098ac282b9b6accf4e812c88550a07773a94a7020c23868b6df4d50f9c5b5f99af09c4e55282f6677b87dd2a60414cfa434ca4b4efe87ee5ee22c1acaa03ef23bdfa257349e45748d077f57faddd3306973dc1c06030cf6d3396da2d78bd052ac8c36ef369fe98dda93323a66610caa4a5fd8794b2770bcc5d0309ca01d2be077ba2bf95c85b95c3c9b03433aa51c68e07f6893819d72e70b9344a2c13871b6ebf86aa4bc9feaeb149d99be9ed1e8f880a2e7495d4576001742709f9d3ec785e0b5274d4cbdf53645661e8c5fd38b68cddc72f982be4745f8edd8076e72d17457aa2593de5f35a9c7a5329cd2b8cec8048edae288d98b077107dcfaaedeed8c1f0df0dc751544d5e70e53cee61efac45e03193cc22c5db6c47b6b0bd34ea29702b6e2a78a13d55dfe95aa47662ec0c83029873e4a69f2de805e3600412a6388ab38d3c6f6fba2b231c729cd5c1ea0caf894e865f4c2a5336614d76849b58cd131e2c7526838d98aafda0843461000f68bed4e77c0668e3c582b8a26350175e32c57b72634a08e20c42a04eb1f93e26133d40db57f683920c6790e2aedf19809b569a0062ab76a3f86971c87051f619d2fe2d8e723b16112719a5b78f490c866b808356b02032976517291e4e1c9d432a9af22795fe070012b87a4798a7de32700d499a169338e459b6afcbd2b60a8775d744303d0fb5b1d85d59d44fd7fb76ebb1228129c7e3c5b8da145b8dbb52d48912e9ddabaf0c53f4709be1ec5a7194fced0771d3a1d844b93171b60fed2c4cb99b2558d8a9ed806d3a089bef5bade8954138a8424fc9ceb4295212c0f1b76adc64b57d8018a873185c85837493b9582eba90500ec128858662dbabca8cba3caa53743cb30626f38b1a44a56c4b4cf903fa29810764e981fa3a44451f69de6733164941db88bc666d1a8c2dd49957b8f2ffa65aaabe5fb5d71e8919004715fa51079f4e183e2d8ae811760a602ac55af1cc6bb31c64fc9cd392145447d38cc26285444ed3606ea4cda5f728d0cd9c22fee4642a23aafdb64c400e471a96df193e7085b9ca6a27bc508d737a36e7ab50ad1c7a2bac50346ca0a5ab7b48ce71d408adbc557215700e29acd0287cac0637c6d6527f36d284ccbeb7823eead34a5be96397e4d3ef5520158b16c7247f1fbf69c98939a3bf3796fe2f3dc2ea23868f248e94244670103de5debc52bb4f32b1003cf38c7b608dc88c3399b20fa585189da07afd12f634b77170944dedd954975d42ff63e696f3365c22b4a377e1ee9dce963ff38b8c18843edfb9d1aa3a20147e344dcd1ed6433550acd4f10342b22793b8479f76dd79b9677415199a96970ae77f199a0dd4c59089ceafddf7f22582cd8bb24fdf869840467ceac4b24517944629e153e685af2cca5269eab0c70fd7b8a4c7ec277050eb55c40c2d5008797d8d9e7d104c54b18468bee06071f5b99a039a4ca48a2e03f8a106cd07fc0dc54a64f75d218bc02b31b2a0e5a5f191a455273b0039e85caa5a91a1c0dfac4b99b58144c4b888d8a8d6ae0994793c15d3e89cfaa29d72326d170d13926667befcc28a524c768c65a6c49bd3e852a9edee671c88bf0c9a96ea551ed6fc250493c49251b5ceee70d1a9afe1822ed3dd13db929c52700eeb9e52502b9a09210e96d3a750204b8714042d3ef48c3037f4e34ea2becd342a90c6db1c7aa1cbae0cb7ff7e392a33f4764ad64066a078d55b4b18ae6e0d45530b65328e5d1846ba98f4886192d1d3c2db615eab519db29e78c60883c94c5decff904acf1d86222d13577b4c4269114eb17e7b0f454943526be9f72318c9ec8ff0fb3995ccf179e98d16750b558230b79c98c67686381e5c0663cfdb87ae2ef545d49d2448ff00b41f459d814022b943bfa55b4cc21e8853b94a5004165d68ce4c87fea2a8579975504d56f0b1a8e188eaa2c1ed376837972b21d46fd339f3f1b75388276c65ea2d288597700b5ce8b057faf417f22872050480c65fa113f715fb0a28ac1c7039057163d578bd7980c3db1ac7c2fcb0707199f172fdb3d1017901ec336df014374788c9cd22dd851cd848a7e534b9a7495cf4f612712f4b08c0bce6a03547e93a0e806d04015ae9de8f9503ec18a151ebbee5f317bff530c07e57165b2a5c626d721460670a9b3f2d6662dd5c5e4107eb0d36062344677e20679d983f30c382e1f6ec7ab4b37ff0d9e4d0866e43699f229ab8296701b221a7f14148b32c56245e898deb37bc3eaed1ca48bc6df06835d9ea5dbe0dd2f59f6ada2f390b6dbd42919a6b3d59df98318afd772d6963bd2a190a8818abfd06bb3b1af0c76775a424552ebd5bd9d21e1839631df00cb9437de3b83d92c92b05a9abbbebc7eadbb647bc9314192f7a7ef3967ab77abf50131224ba38cc3f6c662854c76c442c78e5f47a9cc5694ca6c6fc2995a006d456ec5e868d4e544cca2af0c3390f23779e98bf5d0820678000a12bfc91db8a93f8d10ada0b9553ba16e09d02f6f1d50e4b8ed20d0721f7a5588654fa7c0e067c70614631d12e3b7a2b9f1e2b91ef227f624ba917e3f274bf21a91b89665b4f9219440ac3a1e9283c78d2089cb356edf98fd936fd5b3afd3b60ce02f702bb19ef50c988fd1e2feee605bde00b09642ad9b2890a87709bf809a7304d2b5f464f48f5f246c8e1b45ddeec5fca5131918b028036bfad4e6092c423fe50668d761d909a86d0720abecdfd530ee29329bbf4aadcc908454a7ed0d9e5a1b1a8952329a2131162f72af769ecc82d065ae9003463858efbdead5960e3b19fa8b15457036135be5c23dd9efdf844803adfdb4ba5eea84048755d63763d46819f0d862bb9badf1a9e9071b3c19da3dd2c4682a27cc4ef0f65d51b5837f766b1aa68ce90046177baec3c9a113bec54e7a4cc2c160773a2f4fee3637e1bb69440d347722ea0bf967b38c59fe32d09f5ab4f04bee6a28e9aab00e9cbb8559bbec3c74449bd84cd65a25257d2691902f50a8572de42ce28e73b0a22673438e52515fecee17e55370ef16d77eb7f5f0edb6e1e14b6e65d942bc8b918baa695d10cdd91f3886184be5ac879b03731a4b69ca944104488c03aff7f19580fd5639341a34f38699688046100a9310fccffe8c82df1929048bf165fd1aaa26aad4431c169f37c4d92455e34408d4a43b6e1a4b42ef98494dacf468f3141228d7feb99c4e796dad834d9d03c86d34f2ec716be7635f9577a19d1fddbfd32f9cbfa27d9858bae3dc70902c974a730ce9f84b243bf3454689e280a72987dcdc4446aad741e8dcaac6edda6f90833886bcad52e1403c9febbc1ddfe097a70cc99e1b99da7d627cfbc4007697f6ce61bcff6e8f034386d6d294604347180b057b2a364097ff85d8d8d8ae57092f78141ea0b7a5f0acab4d4db5f7866792ce0bb225ff38b9a3c2782f9bf9d814938de85ad964a506d1cf1a808ce36818bdc8870df66be307eba62f4da5b7b4f957a4792b48286bc00de53ac3b29f9712e22ecb1c5e6974d23460e2ec32e5726940c9614b1a08a3ae9f55acbbd0543535853afb810c8c1f8f6165fbe3db91b1c41f9fb5fcb2eed7fc00d2b0b459f9c7ca7f61ad809e6ae79ff8943dc310225da0698af30f03ba747d6c4a4932c1659fb6a4664d9be5d8947d9561e45748d985e6629376b92e387129074efe1b9394652001276bcbd738d1100f503fd9128a6f846d7ce79cec07640a2419fcb1357f7e15a16a1039ca76786efd21319309e776db415fb462727004c98888cf2380642eb1b2bf2d4efb1451b4b9619ef70a81c75c33e59ee3f53d8d6accc930a150c709f39c14af927b99609cf9cd52c2e4511c7fc70c13c3713d203a01b5189a385638cef93c1a2a0659c0aa9824ee89eae28f65f8b85e61ff1bf5569b091c6ad8b29e56b38f2e992fb5ef9e4d0735dc1a69788034136df6e35e4805054ac1abe3264eb32017ee1797c1df8fd557124d4daf6985d33a54dfa86960e07b57b84a0b52c4320c26efb653a44bc088a124b0a16362596a241dd1ad95cd66919a512999dba248fd6279b8f574920e6fe37514b4a49939d90c82ece0a34222c684088e05f5ddb933f52a9fdbdba57d5307ebe5dffaac4654add81de472ef13fecb059210ddc4dd64d860b14c8a87455af563bd9b228b92c5846668bd7bff946b1d724e47ba17fc70a7371eb431d96b16fdc3af2137791acb9b2e1fb0949b2150490f0e6d81cd8e445457a9ea4e001bec32b55de715e81bfd0aa69a3c310dfd92c2c5a94cb20eafc2286b173b271123d5eebac2a63fe857127f8055a22e9fb84b6f6bbd3dd45ecd65601c63c1f6c33f1b286595412a64fd57f87096744e2200414d6c6d0d9b4961fd72b3ea1cabe64c80a2a359d269efbdf89d85a4d7406f15e670ac707a716c100425662b6387d75568250baed9d5088a2c73212584a67d1fcea135f083b5c88970d51efb5f276581a0a69232a5e73c7f7952f8ef5478fadd4a3def102235dc686ca9d9d740d2dc8c96087a9d6dd9cc514b2830f481de5541ba0c7d570c1498c378e0f061a0289236b237c2e1a822f082c4c79ca2385d6d1593e9486a1d699fc1d6c844e0a49bb1f949cd04fddf492f14795e75d48fbdff3094c146018a8aef59e546e2733d60978da01361d47fdfd012ef9fbea0b630a07af31c968ace2e61f6c47f198ecd6b4d7985bc0a3f96f516d4db3a3eedc5c73564e5766a227ad94696262d47dc17bd62649bbef03c0630421b6f44c79040447df7692a6d8e4317365ce4ce206fb77e4d95b79efab4d2f9b88cd1487a50955b5b30562105259260f5e319c9330085270d1e77eabef4963b97097d2daefb3577aa1432b2754264973fe8f146aeb5d0dead9969b87d9ebe01968747348101858c8f55105c5535e10f304a7874bbdb29253d1785e326f51c9dcce9d43028ee8458b29020c3410d49d220133eca45d9e8c60bcad765d4afc4fd53ba40875fe9a35e4809d350e0cef6413c3c2c1d6ce0a6de471064a7e6e844b1edbd01dbeeecd1ff0042e586a92d52f81ac2418e711e129c9a170124b3101a770e1f5a850c8059e85b0dd7604477389a54b5eb1ccd9a1f9753a3abc22830781b7c96a3cc68be02dfadd20b9732320f92d6c3b15151b61f26b250937a9d1d0e76b426609be0c071628a62733be1fbabe007a0900598a17fb2d8f704b2c13dab0057e0887c41aed31b247e1ade0c1071e0883c73b24017f0cf523887dce2916be6757155012c608516b7a7ced2e9c8ffcee7914e8dd1b267ecd7f857cdb66b211e5142749b8bcfc523f72dabd0e49b4465f16c10876cfccd99f1e60bc1ed8c6fcf24074d8607662f2481ec14fc30ccc42e64f0ca75679923cf8c42eae737ae5950d6d26fa358520ab00328c509069cfb972f54f3305cb47137fdfd2c98dbf3d20d99589765e87fbf8666d86b9f65715d1fa542b6764d417975eb75dbb30fbc47b6ffaa7921262d60684f0a68172da562a2895244b6e0929e643583b3044b8f2e43923e127e60dfd8bfaaead7e117e6f825d92f8d11bd211c18da777067f9efe1bf135c90aa8cfcdcf115364b309b4a511c84b4cf6de454362384dfccdc3659d41a3955352895633101e5732dfeff40a30af13db09f0c7e2695d38488512e89b1f0cc6aaf3b1b83c5b87bb533fd63abbe5c41e100ba5f9f1af32e7e2d0ce26424c715969945b2156d3b30ad633b4b50e298de35d9111f8f6c547e7d295870930231d4909beaf714e4e1546ce39b900ff9fbc499131482959233d715fe3d8d3175f4a64dea76c5611d13f2ed37d102a78f0e9dc5bee8bde6a78d9f67c675fb6336aadc84f7e69534185060618ab1d8fd1b2437393f4a4d5974b4b7bdcfd9e5102054565789becddee552728394abc0cee9fd336488999cd7e3e5eaedff0552717cbec831444f647ab82c97f8000000000000000007162029343a4043"
	assert.Equal(t, expected_sig, hex.EncodeToString(sig))
	assert.True(t, pk.VerifyInternal(message, sig))
	sig[0] ^= 0xff
	assert.False(t, pk.VerifyInternal(message, sig))
}
