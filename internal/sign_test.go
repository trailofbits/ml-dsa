package internal

import (
	"crypto/rand"
	"encoding/hex"
	"testing"

	"github.com/stretchr/testify/assert"
	"trailofbits.com/ml-dsa/internal/params"
)

var ps = []*params.Cfg{params.MLDSA44Cfg, params.MLDSA65Cfg, params.MLDSA87Cfg}

func TestSignVerifyRandomKeypair(t *testing.T) {
	for _, p := range ps {
		t.Run(p.Name, func(t *testing.T) {
			sk, _, _ := GenerateKeyPair(p, rand.Reader)

			message, _ := hex.DecodeString("48656c6c6f20776f726c64")

			sig, err := sk.Sign(rand.Reader, message, nil)
			assert.NoError(t, err)
			pk := sk.Public()

			assert.True(t, pk.Verify(message, sig, nil))
			sig[0] ^= 0xff
			assert.False(t, pk.Verify(message, sig, nil))
		})
	}
}

func TestSignVerifyZeroSeed(t *testing.T) {
	seed, _ := hex.DecodeString("0000000000000000000000000000000000000000000000000000000000000000")
	rnd, _ := hex.DecodeString("0000000000000000000000000000000000000000000000000000000000000000")

	sk, _ := FromSeed(params.MLDSA44Cfg, seed)
	pk := sk.Public()
	message, _ := hex.DecodeString("48656c6c6f20776f726c64")

	sig := sk.SignInternal(message, rnd)

	expected_sig, _ := hex.DecodeString("8410f92ed3346a27bf692b88ea5bb99710aa01224579e1bdab35e0d438c379068b4aab692125acafe4fee066ce175e53eacab3c120f4b44bc2cb042d68ad1fe0c9cf9e93420805702e67c1979e8d4ded8f2020a43fcf93b1c12e163bd973ffac0f00c17a9fcb41b0809b447f31d19a544a8b9d969c2f8765f2797a347b9d0da21c25d66c132a5bbbbb1ce5c9e92d29dffcf2ffc158da339697488f95d1b80f1a66ba289ad18b632ae08cb814a33c09f7b3e207161920d6310bac16420e4657f44f0cc43f7357e884070c47e67437153210a1178d22d3fe3a8435edb49a6902a6985e99c35c18113ce323f9069ec4c03068081f173578751676bd3c1fd4ea842877a93173bcca03a264416192451b021a8aaa8832f25ca0971d2d48b5ce3f389a4619ffadb27e8c4a1eac0c06f1244300091d9e7ed3229418ba8c7131f8f03bc06065bf1f77dd5fd097abc0975b2710b275010f1209ba445a9e8d0cab46486b64163c3d5679611ef7ac0676d53ab531d356b32e06ad2bb401047aa78bb3554bc8bd699d95fe0537b5e31c1cadeb1b80bedd65e094183e3c9a2e35b236d1cfc1b614493a2b786320a22e1c61b33222ceda663153347a4ce88d242572431a37997810159a42d0ee7def0d75bdf947c96ce2119d01b8f267da604dfdb2d2f0742cafbbea39e7109ed268fdfd7607f04daf831a8dbb65c1737ca86c3899b38077802a96851272422c34dd1497ab049854b86f0dbc0b704b300fad81b20122f3fd0e45ffbbaf32684c71589948d86a4bf1273a9823806d8f332690411ee8e6026cf9836dd93991f43f6d41d5b8285d7455306decaeaddb1b33257276a89ac2dc80aa2a3e3d9964922ad178bfe6c3f05e73e88a9779fa1c66f1c866a73b10d7f65cd1961a20751a4f459087054ed0497df65be5f713f74a2c1e9b878d4928165556fe78cc76b4d776a5389874f75a705f106732a207be260325fc0054186dafed6d37f02c090bb00a81a5ea84bce13039aef62cf2653c2711cd726a4a99ca2429bc64b783ab51e37ac352730b830ccacdf74ce8f0baea2c4d403ecba9af2b0745ce30d8fd6c7cf038ff971b0515031e63ab56906f80ea4c9cfd33d8f3f644ce877004fd268a7280df6777863d0b80abeb7ee3ae1875b38f8000b877fd6924e5145ccf79dba48c4993ace889d570cfac0058503492f0681cf84e48eda6197fd46bf1158eb5b69044aa1fa2a949ea5cf213ecf551fa02973ca55281ac08945ee8984bcc05b759addbdf37333374b514af7836599f11269b0f6d1060dbb67388b752d568c51e43afef457608781a19e9a717f2104b071293716b0a9fba81c2c48449d92c7f60793540769a46c0fd7a5087f0dd1ec53185f37d139e53d57d2fca629e5885d15bfacd90b66fd7aeb607ccabb74a43aac251d2e79a10042ed1d5da8c14fecdeaad0fd03b9805fa695c6eabc1f24dc7ab73137c3e8010f65e0b341e415798a5d93fc01be94c2ec7e973e5762d7692977259ccfa3890989ba67ef866aea2354fd7085553020b5b09cb1cee670360c230592ba75cc4ce8161e4acb0290cb7207f8c6ae89e06475df99884b9e8013a3e387ddbfc1c8a637d7ebf7565c2ed26a2942471298eeb90af223ceb055cb0a5e5ea89369686b55ebd987550d04ea3d4863cdc5c3798cf7acfe4b420a528b49f511b6999701577b37ef84c919133323b8fda98dbdb435212a653cc957985b9b10d22fbc813640bf601e366bccb12365ca3a0341cf81fb9ca2beb8dea874effae2573127512acab7963f47806eed9421288646ae1ff4377ff604f6819a5447a79d366b01a74e95053c9a19b9709a78d578905ce540180130a853f2bd7235d8e150beb1151ac2eabc923dd3696b105861333bfced750ca8a61dccc6ae972863e9b77604b711eec507ff459d11cdc25b21099aa9f176eedd4a3a3fcd91fa989298dd4850e15ce8cf092410067b8bdf193f56193f7c71e3a20ef569432fdc6154175d366dfea2e1c50268db83a134ffe43fad15b17c0faf24719d206bfbd182ea982ab8a62c59f8b663d165a42b241df2a13d75059cc60ec18791b1b2ccd7c7be7448f94cbd444f3bc515800874fdbd47925c74d1fb711a751a6dbb828b5b70b4f3e3f4639500bb37756d8cf2f8b0f2791c4cf887f72e2c8d63f127871b4b9115f30dabb413b89c83d3a17d65a4e18a89b64e67bff27176946fba4ffd3e83dbefb9336a5e81a83690a782179775e9665624f779e01ab1b0b03c71bba95195f00e63362eacb2b65cb7f7a68da036828272ef09dfca372d0d0ffa25074fc8431a8799f259ad744d5cf3833c376cf7e8ade8965f430bb5cec53c18c74b32f491e466940a16979c1daa300a0ce53222ad13056c4ece29954aced5666848c90cabf1a4b939b7f051b8506465ccd1cf8b7501c169888d72e95fe75b3883f28c22f6eea3d4023ee8d0769849edb8bb3e8c87e978f68c60f8c595b32f6581357775f1590403bde00e809705baa48f6916bfdf30038da78fff290f3ac19daab405df665308433ede0e64004facc040867f7f0a12b59e77d2870d53321310ee39a2b36be09550a1e65c7966dbb064b5164062b2f7e535d09d3de269a688956266432a9af836eb0c12630f632c0add19df94b6ce18c266e1e7337faa51e21ab7f461327dd4c964a05003c220767f67c71e471a7dfef13023ef45380896e5ca84fd51c8d3b3e850aed8c89a9be7677a4c4b493be4bc4fa577d1887ee00c189da689f1c8548a281c0bb66493469b3235bedab6951afa881708bac1c8b6a89c53816a7d24b9b62fc6952ae634c0a36101b5cda491112f4b955bbb3bd33c76eaaddd9ac645139079da1bfbca6f320b4a352963c03db0a6dc9fbe8edb584904fdc0ac09a4499e7ebb044583836d6726a49b551f67e052e33ecbe1004ca30528468362a3e4bc6445fb7b84eda022ed17b35d8e9c2f811d575f5705c6c4869cee76bce1bb9e3d8750d9e3aeb2b7af31f2218ef3ccb6c2aa6a30a46f3569c36af5239baae3a119365ca056ae3b5916a7493dfb489f1b7dc1cf0fa2e928d5244684acadc3495c55f48ea5cb950dd3f38beb4e95e8d3f6fdc09a8f2cf683b9eefdaa29378a74df1e4ba4fffdfe04b29379f606d06e7daeca481e8c3a30a776f6b23eb581857bb2b34e656adbed18eea69265825993e473903903e2c537680fb3058046097d349a3727843c8b503e8be111c5a87067e98000d7fb953274677769619ae996c8c16e455ee4032dd6ce4c8bcece3f1f2330416df83474d2bbc7e9c0c2d3641888995a6acb9bbbcd0e717284e575e6c76818289cdfa0d3d4a9397a0a3a9afb4e2ebeff00910131c263c3e49596a6f7b80b0cde2e6e7ee0000000000000000000000000000000000000000000e1a283b")
	assert.Equal(t, expected_sig, sig)
	assert.True(t, pk.VerifyInternal(message, sig))
	sig[0] ^= 0xff
	assert.False(t, pk.VerifyInternal(message, sig))
}

func TestSignVerifyKAT(t *testing.T) {
	sk_enc, _ := hex.DecodeString("89D986F1D4198DEE9859529740F5B3C5829225DCCDAB3E9EAADE3A721C1E2D29D971F586035E8A65D59DB8CFF54A5EC89BA7A51E02F0FEBA2590D7D73ED5E7412A364660EB886378967110B185A6DF195EE0AA8A5E4FA2FAE075207C077F1C7FD10D05C4CE6885CDCEEBAE9B2D3C1D233C4CA8E2C0A85466A2EED950805717DB92A4209B20461CA721230610D8420662480023258E50B88C404642A324714CC04C09104098024C8B0642A208254C10685C84600146722017520BC1011216118988511BC72542B66118B764403041E09488609260101525CAC42C99180DCC348E41924890202DE32491D1088890A42412030202008111B521C2906801256CA34002CC846CC1280589206C02C1491414410B446D22B111C4004919492000B544D3384622176EDBB005A124651BB44460326E4134250B140120494C102770D018050824080AC40119110D421888C800028C8691CC28048A06018AA88852300960B0490CC111991229530632984008A3384A4086110B42424B066591022D94B88D21029221B581634048D2322CE0308C4136062042512228700C942C5CC809C3402A64A4248AB44400318CD40600D39008132269E1446181B09022829122A9648A484598886002374C490441111550C42622C844250C05050C446908184E19C7249B0030500626DC840414860CC2844860C05118468DA4028A20292583A81111844CCB1282E1108E2343690A07411828525416400847281911810900518C20911BA56D03246C13356149148DC4422482386492860124B221C948266418482202524A809120C171E216058322001A022D1043712006616046868AA205D1402293A85121C60D941280544668D94484D2344C1B37695994911B1405134961011650CCC8852139600AA311610891CA08265A2284428688433886C2A0451480241C332A5048214A360CA0428694804D88B0291A88401C840448C60862106C22473022196414A8650CB485A1B64104112610C990E2247252126921A0305C164CDA442A0826510C80501B020C10C92013A5698C184D42C22902B5291023914B008AE28841CB1468940250E3324CA49485CBB084A3482001A7440C386D10A224C8366A5098699A04854A386D4404494A9004232105DA92415AA4500B825060306242C644CC22010A81204412659A184A63048E0B8304DBB0219AA489811806984652C3802910A480A484450B8688CA228E198269C03800518209A0986CC4348020A1685AB824C4A57F672AEBCCFC49AFF829D25DB9695114E49132299055F5E937BFD81F160851B9B9610F3F5D43C73070DCA69A91F2A43474794C09AC7BBF96C00097B5603973EA9211CB1CA42E87602CC58CA2976976E39F2434CED96D11887FF08DD5EE17672900B3269660B0DAA9ADF32E6D626F725AE446687D7A9680DBEBA25B3CBE26A48C06F810D6B9BBA88FB6512EB9BC7E1FB533290D805FEF58FEFEEEC6B229E5F54F340BCA312A5D03B582A1A8C4A050455767B26706436057D08E0F058894A48F053A82A2F57297CD7ED0FFFE59CB880BA8AA040FFA657C3FB85A47E6BBC2B6640F7C66BE0AB562650AC0D7856DE6F658EF607F59AE2131AFA58F638CA64871FB357F3D48490D708A18F3E7C7A4E2DCF0778D8CFC10EC3DBE2EC99F68EF4BE56DB78E527A5C61B2B7DC70AB696CEF82E600F4ADB1675B226DBE3AD5F918E9D1072D3FA53186BADAE95321F2263109F016F2EA27734810DE2BDAF0914EAFC3E4673D5EF221D6274832663C2D88F445E7ED7EB8019773605A7E1A57642EFF8184ABCD8F5C099F0DC52D58759AA695D0D57A4367EE32F4D81166A0A10122AC83478493BDFA80CBAEA8269B7C5C77FC09B9E18EBAFFA9E5DFDA466E14BDB560402AE24C3104C19864A110C3CC4AB8B78DCEEC328D0DF0D8893F3324CEC1D0A135088870B2F32CE5EC2757AA720F4804FD673D5049296E99B53101010F88CF1FA8709BA5AC2055861DD0E4A80961FF44EEB058C404DB85FFF1A0B12A2002B9949147757FC9059E666928C91238843B5295B4E303718C30D1C96E0B74C46970C2142969360F30F2F8395DBB57D2275336FA2B0A970C5B2741B9C1BA8D554ECDB0A31D375D36D241EDDB8442B361E30D4C579FF731CCCA1B352F603259FF160980062C6A96DE911FB0D70CE4BA5DFC7DC4AF19707423A4D77E197991378FD4066AB94CC5344B7D14A23C83E7D303E5DF5011745F6C43C33878B2F251648DC85F9322F382291BCCB796F07ABF696F32F6CC8112AD0A19E7BF0A4F787F0070201070C12D1F03145F4D9A007E69224530B289E472192BE51AC14C8AF80B76A1D0BC8D5BD49619912CA3966E5F5EF32C8829B89DAE7C1CB74A3B3C1656FBB1AF0B71B3F9068FAD667B1D342A066701E8B7A48C2465E51657F8F8E8555738B83D50EDC3A411BA9CB9B547BF1D547FF571A8427DD0DC6AF2AE67375E564C2D612BD4C365A70923DD8B8045340D6533B1A9784270542218FD9BC9080090CDF17B012D48ABEC76829E00355B80767D8D1EBFED2C1CC97F3C0BB9A6E4454D2B62AE5F300517754E9DF34FE6654DD609755D5F0A66E5573DB78292C98DEAE19D703DA36B296689535205193DB860E11B1679BF5D8A0F1C8C8173FFD0C6D7A9CF78B190672EC358A06D2695E060BB5A5FBFE9E213B0EB9EBBC7D84B2BCC315B8F989C32CD0630F112664DB16CC657A006478BFA98CBE0B202094447790359579079DF62498961E462E747969C3BAF4D449739E24858B098F2D05418001B8216ABCD3D9A5CEA54472E11A5C3FB67758DD90CD40B97578A40722501412F849D874E5DE782032246B14EA1B5D67B1A2B568C0A5B929DA8A4FBD5513647C989863841C1888AADC01A77094E9AD9D458A82AFB7C6ECFB3434386EB0090C7E2E8B98F3610958802FEB272548332DBE3922789A2747ADD9B48EAFE9E37BA59C72B0CE834F02E3B85478CB86D06ACE8A1B48AE5186B00A04FC36162F7C3453FFAB205EBC347B3C7C2378267606633B1A850FC793024C3585B74F8B12D4F04C6EEF4A82D33BFD4DEA1F7CBC159335DA6D9F928BC996D07C34EE4D7125DD369F287729D0CD5F06FC81FF52BE27C31349C6B1510654BA18A9EC7073FC43474091D26825B88794E1D72155FA527A488CC9E68CF3A54C4D3E1EF1784D7CB57ADCC362F61005B38DB6FFBBA03641AC262E67D363EF78EB083CAE36CF1F8C93BF01F4D106C4539366C18FF3AC070AFAB188E73AA8E00CDA9C0D0ED567ECBE6435E560B132595D16D506AB1EEFC8B10702A7293537B9A6B85BBDFBC2683C3D423799B1DB9F7A64354E77DF9C039F2CABBB610F7711EA2AEB2832465196479E7234CDAA0D43A2485AF9FEE2254A642AD7C9D2B80A5ED50AA0C210B913458E758BF520748F2291D99905E952343E659782F9C614D824FD64434041E75AA8D1C8313AC9366DE8561AEF75863111B863B110B3B7248E5C7DD4911B2F8F6F0F479627D8BA663B06494490CFC9434A3A43DDCE1C83657EBA38DF1FB26C2BAEFC6C9EAFB2DDFA354AEACD633B9FF701A2DBE8C619016DF594A274D1609428FDA52AEB21B43BA6B5972DD2A180B712F6E4E8DCF79")
	sk, err := SkDecode(params.MLDSA44Cfg, sk_enc)
	assert.NoError(t, err)

	rnd := make([]byte, 32)

	message, _ := hex.DecodeString("261F76F64F9E11A9D9A734154ABCFE9ABE291B05982E43E4D5F09511EA72FD7F3F6494E7C2C13D1F7B761EBE7DBA60D118649C9EE6ED6EBA0738B78DBD8D1FF865B1CFAB8E17FE5BC702F306E94A1C8D7E529F0A6A63300E1022FEC01C05226F7D08089947DF24B76E070117FC7EDD05F9D492DFFC9D006E4B178AB3CE6D62C91AEF85C64F156110329BA86AD17C269AD5CD2E7FCE3C5F02CF58AFA9EF57531671D3932219B3D22753601C5BA0CFC6FAC0790B2284D49CAE129E7A223DB5704FF748399876E614E0EFB2546AEB71A1497BED5E5FA74A5FAB6B0A092D94C1DAA8CB08CD411841E71FD9B26DE38008B81BCC0EE4185D3B57C48A52DA5E06EE935C96D473A48C6D575F05BC9BFF0FE9FD46680F1C271E717C3EAC59AF70A1EDDC75B17CCD7E4F212AE836028ADA79041E39C27C4BE26345D86352C2C5B7558E628F9715032D23C0C2B4F17F6CF7D5CF00721105FE047D738AB5AAF03E11D61C67A3FA5FAA7A762F3EC180C856EEFA835491D49BD3BD315CEF428F7A5D6281437D476D677A2961D40EE4C230616CB61A2F0752BF555363D50A74890B4E841301F1E1350C08298AA75029EF37933CD1784DDEFE71637224B253769105D1B1FDFD1C566C32E403F82E78B6327A06B74B9B7A5ABD4C822F575E141A100057035D82A3F5EFDED84CD20B2A81A0BBD039CC6477E8092F34A1F30B34447FB70F23AF197102B3D31BC2848389F2EE763B8CA393D11F24071CCF8557C80BA15CD05CFD19F7DC4773CD9E839BF026FEBAF9BC16D6A14F130C3CA7F5B97681719F5E74A987ACE832526344E3E52C61AF1288FBD83AAAFFD179E3A9012A2EAAB8B083AFFC9F3886B6D2F6C1D673C9F7B63ED124632E31F44F5B14E20E62BA281339B7ACDCE3A08037EC2A0A2EFA5BE65CF20CBC5242E4705C60939D206F72E0DC25BB315925E9C3FB2466489E8E54E2F834528143974DCF6B11D1C6A69BA59D34C99883DC531AAE734F53A01150812E263938C50DA7AA74A8988574D45D124EC5779820BC7B1C30FA5F28ED0BF668F185A623B9E96A15CCE955FFF884150E9B3C5F97794106D44AF22230227393C9A8910989E3F84FAE5CF1D92691C60E522A829C81D59FF9FA0F891C0997C706A610E6C507D73F9137BE3536723C165E67FBB9F7291AA4B06E98E0C974300DE39264153CF02D0A0C21ACB625860D92DBD8FE4D167A5A6BBC4DD6F312E3613DEEE3BB430517EE5CB512345195D6F18762ABC42BB21FF19ED6692D2B4CE31D4173418D170D6F3DA004B06C081930D5E97923D63024D47F7BFBC9B343B8F20C211B4E816AC06BAA39DBE900319AED6789ADE51E5905398FF4AC4D82B8A8198904E207F581BA82CF977CDB69B4C92BC87E815B5C41F6EF2911D03CED8F032714459DC95D636BE9E5092715482E4B5F3199DD86E0BD5F27CD3F6B616B9F8CF6ADC50AB414FAC5A5046219BC68C42E95733BDC7986B0ED1FFAB2C423096F4CFEC68FD977C3BE9B0D136336CEDD59D9926375D1B79E5286863CCE73AF07D8093A30F6164256920A44F37ACC0C372AEE6D62CCFB13AA7CF5DCD13009CE038E87DF6F6DF8CBC73B5E5E887C34932E58B7469C763E8FB779A828C1DD7EB4F092C1270EFA64EE708BE4A15CB38C52A5B7B950E5FA60C4B696DAD45B6956ACDDBA1214CEDA4BE8A89C40FD3BF526914D049218895B6F03A7900159E30C8AB1881F968245DA5637CF43AB54FD0854B8F0BDE1E61ADFCB733D58EE25121A2C53F13E068FAD164F2FEAADF755CEAC5B96B514740F607CF08FAE4399950941E5C7987901599E0ACC64CD41620B6E7AB7D7EDF767F7E1C5CDF298A4997A7B1C704DB866CF8584498D1C0B56D52E6E883348BE15B1798F9D2D68FF85A22C27D8BBA26FD193A1C375EC9F71F6950F2ECD783BD0C05236BEE01F4C0892FB70E8FF13A06503FBE6C30309104C705AAEEA35FBFBF68B2B3A7820A56BB857A5CC863910CCA57F4429C86EC6FCFBCB57644BD7A3AD5F81AAF9CCB81FAA2CC3558A0004DCA4D5A6868EE35A7CA084F7F398CBD22E0DE2A5D162DDE5722B0D2784450F4BF3EE6422367AE4865330E487DE3EE42DD2B10864D6F3F340C60B216A14368A61286336D7C69D833771B899C4A3A4F19496215E0FA637AF2AC62AC0B9B1553EEDF4882CD0D37A4F31C0AF9C851EBA6B87C5D3C053237FE95433095215CE44E60D3EB87F0E2BB7675674828F8F8CE234193F8EFE98637CA5739658873AD1C3B3503E286852D3AA16C36B24D0C9F37FADBA4323D982942536A60B52B9417BD27A444B830F399D783C181192BD9923B0C64F99020C4B08FFD34E6206CB10C3275629BDF37ABACF47BD506FE181677398ACD6637C68D1FB3838C63DDF805AC8ACFA93F93132D0872ACB02D3088441C5102DE36094BDBDBA4F5AF0C301E59B499059F4234777A17C0D6A203A23205628FCC7227ACAEB22A01EDA71D2AEDDF14B0626F45EAD3D8C33A8AE4CB65DDB94C12C9FA1F230A17085B8A161D4AB492B5A207E16B8E283C79EB9531B3B70DA427FAF1C1BDA3811CA1CDED6E175DC4686C3E9BC909F5B43DD4879D904FBBD4E5B99163D1B320D1417B01E71FBC0CB4178BE4ED989CC7458BCCA4E28EE4FC2E98DDA96ADB65405D59D738904F8170E2C716729C7E44A28F247CD912007AA87A0B517880AEC3DA9A1853224B1BEBB254EEA56D376EF780016E483EB5FF58A07C12447C01E65F88345DE183FE4600C75322C87AA0F6BACE77535EE036F8287BAC41784BE34EE52D595653F22D7ED3604E7F36DE7AF4F1F46E37BAF703A8EE88401EF2D1B65F469A01436FA2EB28F6324A62991580688AAF232EAB29D8F660C8F94F1B23A12DC2E794B74705941513095193ED7471E7C76B32A40F7936DB51584903C80E3257D637D70AFD47D3CD4322A7E1F52A4EA9DCC14D4D7B7765A9E2820F1AC2E747CAEB56CE3C1E4EA914A8AE2B6513295D60730BFB0FC92DAE9463F549A65C7C7B7E87CB0B529AB1B5C7C1166B1A1BD99F3C286B974E65DF85F6A958FDD4166A2B13C8473EA26585CC0A5A60DF5F1457FD51C95010879043C5C67D70E856CC0038A0658F62093B589C48F327822B95F36791BFB9D44F1A90933A506A0B01CECF31DC9C75428BE9AD1BADAF2B18337E16307872B725FDDCC515B80B5BB646F63B641B6AF041C66BDA48D5B7B1042048AE8606A1013D32DA9CCCDE3BBE663282C36EA34B60D1F41CD189BFE9F09AA9934166718E390A64EEAF7C3CF45EA7F59A32D6426A9761BF10143FBB661BD246D9C13CE3A3F0655915C93ABD1FF2085C9CEFDBCC47746AC0251A61F382202E196C9C3F0CBB44D5660F1DC6D55796D98207C1EB94354EE308CDE82889567466DCAE9253E974102E8884010B2A8D38B85DA3B867E90CCCABB085A31CD9CD59671A48440E0FF47D3A7FBAF860E0FF68BBEAC1F5E2CD8EAF20AC924866BE8FD970E4F20A9339137A538685E6982D794E08EC61ACB34E4E6914DB7D218A4803C0665315DA3EF8451D8785442126938A9DDE2C806A7EF62C96BF2102D856AB0F97B7AC8A22CB577A9946D092EFD50D8A17B3D3CC89DFBB6CF075D121A9819BEE2A65192EB0BB3E61AAA66015EBE69267E0DA847444C564A0E66D45513CF210F95CBC79724CEE64AC281891EE7091DA35C71E23CA8AE8AAA3E7561D1567668A4C94E0B7B61C698614951F5CEF794C06F372ACC7B73EB5DA046285EBC302F9BB85080B3A87954CD29EC5627064FD1D39C329101F12EB8257CF684D02EEF84B7715745A0CA30F301391CFA339968542517574E41E8A0F3FEF04BE49B7B8EE92420EF8F5A75E82AEA737AA2E52CA8706092FF5E1813A4A700B1BA88F41B667BDB0127DC09C8E624756F62E68FA1A5B9783FFF02F669EB4BFCF858419A5E9A4C5909438AE521B06094F6C8035FA19F59F355E68F68C0841F8B0DFDB9297B1B3D73C1872EFB980E5FCF68C27B887759FAB282BDB59B0E0EE1373E23F4817FC85671507AB89B51DBB00A829D76A1BC5EAF017F38F2D28C8EEE7A2380D74918E26DDF6338E6265A79EA748F422AFC8804B8166C0C63ECA7BAA937A113153C50404CAC9AFFA574741C0EE2259A8C36C68F8E38BC2789658E07DE09AC5B42695B100F1C78F08B163C743EF671F2F386C35692E37C704D5F5CC59C2616E2E9B21280D41921508C59720AA90A87E62A2B2DF5EB960D55E93029306D0549FE21E67FC5DD9C1E217CAFECA03866A17790CACAE62538C86877F01CF23A9D0079F9AB714B8117B0F412522EB4FE8545062364CE6D7E42AA933100DD8E913074AA64EB257E6CC5DB5E374929CFCBFA68557EAD23AF4864641E29DD105C76E83E3B22F9AE67DAC4B4461316D2E361D470415C5377CF6B96A413520042200CEF740A2C8AA33C3BC5A9F57D8F45EC78B71F6CFE1C4CEAF36AC6C536EA2D83BA31D659034A9A80406F5EA93E6A3A315CDAFD7F84FC52E2497855C70BE4AC9A6FE760B7C1A2C77537A36851FF96624931D2AAE2849C6B1AE897FBCBC0D124A9C15D3FA1B46B0406BD811CEF173B7945431698308D6DF7AE881423C5A885F753937F8C78DBA65FCA0237507C4BF32F0B5CA450B724B7284DD61B471336063D0DFD67E24647D5E993CDBDE8B5BACEC9CF2859CBE692F5BA76C6D34EC4392D88EAED0B4A15C25865278BE3ACDF2DEF2125DF8041BEF12A18477CA59FACFD74767A9D15A5DCF3A9506918BC11AB3D371B65804C39B0A7250092E73DBF12C27DE49C8EE9164955A1711931E8E4F1BDFF853BB8612AE2110564B45FFA7D64C38152FCAECFABC273D4C7AA2E4AB60BD95F8D64A18294147A926B3AAC8A1E1C4BA064E7F4BE514B6426BE4C76A4757C3F103E7D17C804276847BAFF1A0FE931213D4EA4C7F51C17DDA52CA6AAFC5B3592864995BB405A9A442BDC10D62FF090CD6949D2D9070289A5F9BE726249534557912F0AA0B69A6B0F28ACCA7EC1119C178FF0FE41B3C6C190E94C56AB6AC2F0F65BD2E8CB0820BE678B859FC99372F15069DC243A4AA12A79FA12C07402F695C7755EF1B26205F3B42A48E2DD3FBCA3AAC058A1FF8966554D854AD0FBD4E8B06E63DE86371DB2A90BDBAEA19FEEAFC3CB0E955DB264F8A6FB960E650B10CF62CCE8D18D0287B23F1E0A06F83062EB5BEA55E1CB37B5983FF0E10DEA5CD0B311D3DE038A4A9919ADDACC124AA3E98709806B35BF22A341D0721B261B358C0C3155AAE1B76C6BC72015046E78850B5A17FD4377690209BCB59670F611BA2EB148459755FE01854CF7D438C8DE59D840692CE14AE6D552C9AAA8E33CB9639C58DDE3C750C57487F847294CBBCBB36499D32959AD120C9410965DC985F9CC764490037C43F2AB69C2DAF3577BE6E826732DDD092FA72C5B5926BAFC2F3661EC9EA532A4F1279276DD5900DA6E66BACB938C00E6E66B1C7634F4A3D56889C3C3B461BD36B17BB27414C3754C1E614FFDFB2385F2FA154D5CDCE420A39BA63953A51E3BBD63B6EE187EFAFB34C8F95B55983F7BA2DC69E2EF1F21ED9F94316E0FF73D4579B6E73C76C5615BDC046D7DC983B5D40AB63190EB98F2A59F2DB47ADAD700A145C2DE0A6D4931D46D547AE1C5C11A530F0B461098830858C15585A89ACEB057E6323EE3D7C4E050C6CA14F3F0B3FA25D54E498A2EE7D384A6B6CE4D9AF89E81486B94BFE7F0A2589674F76C08AE0F8FA220A03850F8C27BF225D37A1D76C5BE361DA2FF439D4676879A83F162C6AA7A30ECC360B6D59EEA6AD85D2D6629F219665A32B2283F7C6680560EEFE32D534F533AA30F8F2B1869CFCA3FBF03C7CD9589661EB615FDB4D4FB538CCE3F6EB5AA9761F434BE7C7F841048B0DD1478BA0D254D5E98D7EAB0486E628C0FB028B280A85437BDD4F2E2E7FEF6A0C645233788633CF6F1EF5DFECE1FC926A1647E7AB00FF6004B001D4A1C3E4DF5D6B9CF119504F08E2AD9C176A99F37DB1E0F2135F4CC5A9657B83B79F167CFB366069E06FAE835C29A73460BA54DB987790EB1ECF2B3FC74BFCAFACBC78B0171E467C46226B1EAD0FB13E9F1411A6051840204F2D9B41B2A69C5B7E4B930D683648725069F3D897E018BA00DDE653A77AEB3FC9D0E65F9096E63A0B02FEB5C9B21C7567B910F0480A01258D3BE898E0975E7D015CCF74ABA03B716A4BD2991595E5E976C6FB05F7EC8C8955820FDC084085ED9C045BAFAB834C52BF18ECD49356B78D07F0E96674FA815D0C7AF7F802EA8A471075EFCD22FDDA503D6FF0894998F45D8A12C69297A6538BD18EAD85D389C2BF92267D97B431AFCE83810CC88662EBA9F0DB71D5AA2C7D8E0DA40ED2BC5DE14A3876EC2532F538FBE860BF1534512FD05169E3B4D40B268E5BA08CED3D882F32A64119A6433D03D49045D0D0AAD93E8A813C6AEB90878B522D3F6246C9C941C93159FE62DBA11CBC45744C5F5D53BDCDF746B67F51608C94B3F5575FF95948ECA53E24689735C137ABBC5C1D1C3F57848F5B9012B5E70755B285A8ACE8C8789191589EA4D84D2997596C5658C64F1A5C92401861FADA3543E30CA5B0CD2A940205126C369BE9C4A7CD9AECEB2AEA52684665D78CCA8DB3FD9F2A9EACE4E7224657814328B760B279CCE2EFAED7D47E81A99AA7EF70FB93483B23974E63918ABD39C4BFA97C0C02EE5548785DC5EF212678F23E7FA46C0B172ABF24CA4F17B24530B59DF8FAE783D81A4C5B7C02BE075FEDE65615D6CB72C7CDBA80FFD41D3AA0C47B1BCD4F0F0CDF18154B1733C8C1BBAF08D779C876C05C82DD0807C6ABED55638F44D479A658C5502E9CA72805A4C5C2579BC1729E30194F857397C46CFDB4BC631CD89E94034ACA4A17F8901FE20664DC74B450A9B88057E3687CE1231F78172CB70A0C09A2371BEC6B3B1E97FCA80264BAD3D514D1636D28E230CB1F27357536808CC7F47B2FB059C9220D25A93A24239C185884AE97B97EFE77395280E51E7850C7D220DBAE8D136883AC9AE26BA01B935BF435ADD5FE52BD9392F84328DD75BCFF814955C77F905E066AACFA6712817F7C7B6E5ACB67E21127E85B4EEB19D320A6F204FD1F981EBA5F0115B80F8A95FED1D35CFC0E2CBEF47E58FDD629FF6F1C22BC750D016342D9776C878A6C607A25CE853E4A25F5DD2C0F065052618616D68B722889B06474002D82E1DB48CDFADEBB6F6C40D5FA8E4B3635618573605C6937C048673F25952AC60434B4311351708BC3C2CDEF5EA6C3D957AF458F3A14523722EE9A3E86A28E3D5B9F7CCE6792D57AF0BF87C2939C266A76EDD1A3C2765580F32BD3E8DC614B5B95517B75114AC7395317F59F95556306D766AFC1FE138EC7048E092EDC3882F64F2D27F6930DD116BFDFC7414D6A1F0C4AB0215F679A88CD481E82E26177192A6942F9B461BDB708C6075C86E0D6E597707AA5E552EC3948D199A45A06A72E1C56A82822F18F76F095844B90D36A56FC7889898F936FC28175EB33E8AE5C8D11983FE137C36E10F9FA4955257DAF34157242B683B8B64C47EFEB9112897139FAA9B930078FC94F2F1D3245EFB7B27D070DCD59E84726CAD8376101028D2E3C40290CD7EAA631E2DC3B0DBA839E83A8E0FE1E40C5C162F781A3E63962A57A2CC7C5E46360936B154E832B5B4EB87EBE70D3A68CB9F5F2249C6D7B55CB7075F7864C62F24CF48C977AD836C7F60F650CF9A1B9E89D00793AB82167ED3AE5FD854B115AA3B568602ABC338D2330BA56045AA63BB905C108E0F0285AAD2F38CB080B77725C03BFB3356ABFA995F1696312DE972605FDF8FCCD6D6E63789DCAEA55D98E9C93CD349B70AC39A1F28E764F5390F878099EA486981B3F809F206F6F0CB2281C30CD040B56A0B4AA8481080CFDFD83D7FCD79C8DE5CF5997C88B3C2556BE330A9B644CE778E54FA61C9A45E1A3081BCB55B61D4FBCB3707DA47CF09646D144DA72BB1509C8E99E1A174941663CFE14C92173069B88A5B5A06E05C1070F56FF6DF082EFC7C13D4E5C51A5F56263EE836573FFFD363F356D6272E6470735EFB00CBBA544C06388B91EB945D0E6082886A50D06E6CF63AB03355353408A5BF7A2228BFD9AEA93807C5ACF50D1427AB0B5B36092FED8124C0A468FD840DFE3787F8A884B96CDEBE7480BEEF91B6DE1931D94232402CB822A7E22BB86D1DB8C5B53DACEC2E58854D8E7735E7102807EC5CD61A3DD2B37533E5D7DD3EB96C36AA67CF1798A33BEF4C1715E5B6609DFA8421E524A3C72094CDD64F271EA49C63742D96840AAC29D28179E25D67804B830CF581DB1DE06340ECDAC4C275BC692E757D6601E4A9EF06FC030507080C6E9198C5E387D211E0DA2F7A2EFAB225D58781EA6AD612E448F07D54ECFEBB92BB1AD477E74B43EA18DF5378E52D996C5BE901C19AC326430880102772EBF1345314A7C7660E0FD7481BAD91191A645917EF40DE320EA762E13A85F7228C06C5716D934A86B15C9BC834CF4126087D8D7732B378B162A1E65F2E78C2A9D70B185CD39997A8DC8CCB68F140D3F406915AFD2FCF2EA463990B043B26127CC58D0808C448B7637BBD476057DC4B6DA5228540F48737E013DCA48BFD126523ED22443CAE79168CD14F8566AF418007240816A14AFF9E09CAB781DBD488B20023F6A2D8E36F75BCC3CF3F9391019895B87913B012891A8FFB28AC2436DA5B11E3166847D6398038B8292B64")
	sig := sk.SignInternal(message, rnd)

	pk := sk.Public()

	expected_sig, _ := hex.DecodeString("84237D58324E9D35DE14A4BEB961B96B7D99F7F6B1158D1A03AB6C3E50EB8E900D0E49B608FAA5238FF397B57B137814B0ECB027618BAA3828C3AD1FB2D5AC8ED7B6932651380BBB1DDB2EAFDA3919D29961912E6B2C67865C6B680362D4A4DB0CC16259BFF5FBC0C3E4263566E3F5AD0CCCBF0E6ADAC15A128A4483C7E0B2DD2092E70D88204AD268CD75AB099AE468748094FDEA1D2A1D747DACE2255D15E3FEDFBF4B6678B66265226372BB342FD7AEEBE6FCFD959CA46A41F023093199C74444AB0F352BE1F301081FA93680F5EB0E99C5434F32E9A88CB52702E72EF1A64F03E3942CC8B9D52168E2E446C1101AB75B3FF9DECAEF75665C9DB2B54A52EED2C55DA2364A5889A198A3518AD730AEDD07259FF2482BAC20B2D7AEDEFC6D9F288152C93B8249680C1CE9341A68C4172440A6388E9E68EC5C24514CB4B6B11E0FC44915F9D7654891F5D5A8E0E5FD5D7BE7DDCC8E88F5A62151447C35369823C7CCBD90D24502AB3421204A382269F6D68B71C241AB15728DB351B4A36214A4836C6849D5FB184AE208CEAFC37B98B910EDD7308FF750782EE3CD0A00E118BED3A13AE437601BFC48AA36DC5D63B20546FE2A731B37D682D0F5A5B8914219035BAA1992A8EE33EAF0113E67CAE7F838FDF6D5FC696AE564630C9C6DE09A01B87D59A407B12725EB38FBBB389BE7F53A1A1042449336F0CEB0341FC3D0C586552D8B444947B5C65D689CDBF3066FD843581A7447F9FF00FCF481F55523CEF59CF31899B933D2FBDAD2BA535D45D7E878DF03C3D3DE4B63A6B3564D63D75DB400AFD28CD5130B935DF9845A6E1B6B44E1EE2AC4B1B539B4E102B9D93822B69297098DC7A68FD8E197E6EA97FF2E26522E829BF36DFA16AF3F8E55001CADD85A75751BB04CF86BE727A0059D6EAA1FDCE96BBBC7AFC91D789D331EE0F7A091BFE58819ABC3270ACF9E8F624E38B76B3E9E67D5FAAE8042242C10C059CBEF8EBA0629F223285236E6E0B533DED4AA18653BF1808DF7E1C6F8113EC1473CBC4D7CC15BF3F0D7D7D192C2F2BA255789E51ABC6D139ED9C16518129E63AAE68563200715473AB12B674C5D1EAB3B48D20A551FD298A37C5766487E95697832394A2091472CE8576004A39AAD1280694D4EF77613747A804D36A2E6C0A2945CCBAB5F042BEB34834030B645479379B22FDBD52B0ACF8360CAABD5F7B32041371A5625EC08579ECC3C895BF72D0F07182F47767A87EE927A54035FCA952F06A87B358BB1975707B51404557EF199691B606F3E8143C443D7CA0B1691BDF515F27C55038BBD66C9377A7589A6FD54A4A01E930D64258D3842400C3C77081BD06C31960A1D659FF2B2F137BD93C5A4DA14DA6D015FE7DACD611AC0F6B55FF345CAF2172AC01F5900C5BAE34E92E645E1494484911BD7EF9930628364C897230DA9A4BFAC5E395C902E19580CCB963A3789713B584422EE9C28E4084F8DD20C045FB3912A90FC4758D5628557D4681525852A3B68234FA821C9661E290D09D4FB22F7B6C476F13A5763BA549F4FDCFB766CDD10F13C16302036C8689D50F65D5C02C731A5849062F5E928EC56E2F3AAA9D0B5C9DEC085451EE850914FFD204B1690B77EC3914B3506096DB153CFF677894FF87F36872121A22B66C541EB738C7F8A89195C3966F837EE3098DD029EB37EE7A4CCFCC6CC9AAB1FC9E2CF690B6EB7677A4D324145EFCD2BD8D30B178EFD524F84CF23185211CA46DC3136B935079E0D6ECD4755987A75C9A17E97170DF0B242D6E2F2D73E068654A338BA2CAA690E0FAC22A4466AC627327214E4CA39374B0C9B4C44371CC29EABD064262962C427326EE711AC9AA4B99D06EC85A9AE741C9FA26EB028C835921C28862A7F779CB77C5A5ABE1457E3F00AE6479E9DEA4508A24F4FE5FF1F1A94533F3E40369658B24834CFBB24F49605C74B35C94FB278295E09FD1F99A4AAB4E3FBB54B6E29601ABB006D1BEA767184202945F81FECB1153B39932E2EFDD84BCDF3D63BB0E392D2A6335344A83911165878F2B1C73CBD8EC2747D7C2553469E6E04939F2EC1D708E50E5A6CF6FDD50F192FFAF068FDA358DC7C164FC9660EC5ED0DC817F4A7BABDA4BE9C7772CA07D7394AA8FA05EF9F68D9BF83C28EC17EF9DF7507C129281F7E1CF82AA6852A52818C47CF8F22315069A9084D87D6DC08148A76A8BF1C18B6E14563C18C64ABC7270C92C75F51C86CC1D4DE617A63E6FE89B8CFBE6747D4C9E35CAC3C392CAD4C834255409EFDC75D0608A9B3118CDC5D4D1EFAF8A3E42F39E572C8958E8308D71D829B2AA276A50CF2578F9EB00B338FBCD890777038F216BFD1D7578D05473170186FF6FDDBAD7B53ECDE7820181E8B50BA793D07132E65CA9F61EECC35D572E83BFFAA016EC72A22C53C06A82AEBBE7BFE2335EFFC1A6BAEDD73D27EFE6F6F6C280CA34FC69A80609A80E1963C7E89F14192F8983F695613363A7F7F03D61A96C541DE5A0225766003A8E675BE1884AC8817646A0619FEFAAD0F79A66894BEFFF916B502C265618FFE132115006363B2ED047B92D6805911EFD3BE27D32EA1E684FD5628A937823714D2661838D42CF036366D7C7FE018448FFE4349D1492D27B615ED514AACDDB0015C12D91A290F263CC29E989665B1D01EBA6B45FB5FD9FE9F57DCA9CD218B38C864211354A9F00621DA92FE3B64D6E77B9C160E6E6B7DCAC5F07C24420FFD89C3696F827B1D96395977A7F6702FEA6DB7B17E552141C63E0568AB225137BE45A71B34301837A4CC55809FD6031038D542144A06866B04DF3F9E2CF1B438A08E5105AB30865AC0E197078A163237CBC013874CD97AC00CA57D5E714EE270011733F9382398E4C9919D253545800C91941986629E63C9B143DE8973549EE42C0A00E70DE887C6D9DADDF0C26A7E5DF93678587B6A13CF93D165D335B4F833A4C7C5C0B1639D2F379607F2D7850F797CB12019A0EA38199551ABE7E37E6643064F93F9034CFA14207ED1AE42A9766BFF4E1739E7F3CAAAFF0A283D3D5473548FF7B948669A91BEBC8E47FB0C54DCFEF3CB3FDAF5BBBEC0692263BE68AB2103199B7763D397961DC5917919124029425C3A43BC1A900492E34B41C93511F600DDC5CC689437139AE74494B11FC0C858F3639FCB329582E53E0B70B66C7056ACEF6FBAA2DA0E0466B302370674CCE1EF0BCE0908D72E5F05C82A1166176BF95B2A425E39931FCEEF9877237A36F2127422F07B7A6A6323F559A3A011B631C4D48340D224E0571892BC8835779BCB614CE5E9B8329EB29D15172D3A4D536A6B8595B5C8D6F0263C5F676F777D97AEC7D4DC0E243033414A5C616590A3ACB8BBD2D5E10D2829325E5F676B7F88B4C0D5DEEEF20000000000000000000000000000000000000000000E1A2B3B")
	assert.Equal(t, expected_sig, sig)
	assert.True(t, pk.VerifyInternal(message, sig))
	sig[0] ^= 0xff
	assert.False(t, pk.VerifyInternal(message, sig))
}
